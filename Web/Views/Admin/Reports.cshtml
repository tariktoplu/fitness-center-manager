@{
ViewData["Title"] = "API RaporlarÄ±";
}

<div class="container mt-4">
    <div class="text-center mb-5">
        <h2 class="fw-bold text-primary"><i class="bi bi-cloud-download"></i> CanlÄ± Sistem RaporlarÄ±</h2>
        <p class="text-muted">Bu veriler doÄŸrudan REST API (<code>/api/reports</code>) Ã¼zerinden JavaScript ile Ã§ekilmektedir.</p>
    </div>

    <div class="row g-4 justify-content-center">
        <!-- Kart 1: EÄŸitmenler -->
        <div class="col-md-5">
            <div class="card h-100 shadow border-0 hover-up">
                <div class="card-body text-center p-4">
                    <div class="bg-light rounded-circle d-inline-flex p-3 mb-3">
                        <i class="bi bi-person-badge text-primary fs-1"></i>
                    </div>
                    <h4>EÄŸitmen Listesi</h4>
                    <p class="text-muted small">TÃ¼m eÄŸitmenleri ve ÅŸube bilgilerini JSON olarak Ã§eker.</p>
                    <button onclick="loadTrainers()" class="btn btn-primary w-100">
                        <i class="bi bi-download"></i> Verileri Getir
                    </button>
                </div>
            </div>
        </div>

        <!-- Kart 2: GÃ¼nlÃ¼k Randevular -->
        <div class="col-md-5">
            <div class="card h-100 shadow border-0 hover-up">
                <div class="card-body text-center p-4">
                    <div class="bg-light rounded-circle d-inline-flex p-3 mb-3">
                        <i class="bi bi-calendar-date text-success fs-1"></i>
                    </div>
                    <h4>BugÃ¼nÃ¼n RandevularÄ±</h4>
                    <p class="text-muted small">Sadece bugÃ¼ne ait randevularÄ± API Ã¼zerinden filtreler.</p>
                    <button onclick="loadAppointments()" class="btn btn-success w-100">
                        <i class="bi bi-filter"></i> BugÃ¼nÃ¼ Getir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SONUÃ‡ ALANI -->
    <div id="reportSection" class="mt-5 d-none animate__animated animate__fadeInUp">
        <div class="card shadow border-0">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                <span id="reportTitle" class="fw-bold">Rapor Sonucu</span>
                <button onclick="closeReport()" class="btn btn-sm btn-outline-light"><i class="bi bi-x-lg"></i></button>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0" id="apiTable">
                        <!-- JS Dolduracak -->
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    // API'den EÄŸitmenleri Ã‡ek
    async function loadTrainers() {
        showLoading();
        try {
            const response = await fetch('/api/reports/trainers');
            const data = await response.json();

            let html = '<thead class="table-secondary"><tr><th>Ad Soyad</th><th>Åžube</th><th>UzmanlÄ±k</th><th>Ãœcret</th></tr></thead><tbody>';
            data.forEach(t => {
                html += `<tr>
                                <td class="fw-bold">${t.adSoyad}</td>
                                <td><span class="badge bg-info text-dark">${t.sube}</span></td>
                                <td>${t.uzmanlik || '-'}</td>
                                <td>${t.saatlikUcret} â‚º</td>
                             </tr>`;
            });
            html += '</tbody>';

            displayTable("ðŸ“‹ TÃ¼m EÄŸitmenler Listesi", html);
        } catch (err) {
            Swal.fire('Hata', 'Veriler Ã§ekilemedi.', 'error');
        }
    }

    // API'den RandevularÄ± Ã‡ek
    async function loadAppointments() {
        showLoading();
        try {
            const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
            const response = await fetch(`/api/reports/appointments?date=${today}`);
            const data = await response.json();

            let html = '<thead class="table-secondary"><tr><th>Saat</th><th>EÄŸitmen</th><th>Hizmet</th><th>Durum</th></tr></thead><tbody>';

            if(data.length === 0) {
                html = '<tr><td colspan="4" class="text-center py-3 text-muted">BugÃ¼n iÃ§in kayÄ±tlÄ± randevu bulunamadÄ±.</td></tr>';
            } else {
                data.forEach(a => {
                    html += `<tr>
                                    <td>${a.baslangic}</td>
                                    <td>${a.egitmen}</td>
                                    <td>${a.hizmet}</td>
                                    <td>${a.durum}</td>
                                 </tr>`;
                });
            }
            html += '</tbody>';

            displayTable(`ðŸ“… Randevular (${today})`, html);
        } catch (err) {
            Swal.fire('Hata', 'Veriler Ã§ekilemedi.', 'error');
        }
    }

    // YardÄ±mcÄ± Fonksiyonlar
    function showLoading() {
        Swal.fire({
            title: 'YÃ¼kleniyor...',
            didOpen: () => { Swal.showLoading() }
        });
    }

    function displayTable(title, htmlContent) {
        Swal.close(); // Loading kapat
        document.getElementById("reportSection").classList.remove("d-none");
        document.getElementById("reportTitle").innerText = title;
        document.getElementById("apiTable").innerHTML = htmlContent;

        // Ekrana kaydÄ±r
        document.getElementById("reportSection").scrollIntoView({ behavior: 'smooth' });
    }

    function closeReport() {
        document.getElementById("reportSection").classList.add("d-none");
    }
</script>
}