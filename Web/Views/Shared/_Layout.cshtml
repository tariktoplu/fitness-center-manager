@using Microsoft.AspNetCore.Identity
@using Web.Models
@inject SignInManager<AppUser> SignInManager
@inject UserManager<AppUser> UserManager

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>@ViewData["Title"] - Fitness Center</title>

    <!-- CSS Kütüphaneleri -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true"/>
    <link rel="stylesheet" href="~/Web.styles.css" asp-append-version="true"/>
</head>
<body class="d-flex flex-column min-vh-100">
<header>
    <!-- navbar-expand-xl yaptık ki ekran biraz küçülünce hemen hamburger menüye geçsin, sıkışmasın -->
    <nav class="navbar navbar-expand-xl navbar-light bg-white shadow-sm fixed-top py-3">
        <div class="container">
            <!-- LOGO -->
            <a class="navbar-brand fw-bold text-primary fs-3 d-flex align-items-center" asp-controller="Home" asp-action="Index">
                <i class="bi bi-activity me-2"></i>Fitness<span class="text-dark">Center</span>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="navbar-collapse collapse">
                <!-- ORTA MENÜ (SOLA YASLI) -->
                <ul class="navbar-nav ms-auto me-auto mb-2 mb-lg-0 fw-semibold">
                    <li class="nav-item">
                        <a class="nav-link px-3" asp-controller="Home" asp-action="Index">Ana Sayfa</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-3" asp-controller="Public" asp-action="Gyms">Şubeler</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-3" asp-controller="Public" asp-action="Trainers">Eğitmenler</a>
                    </li>

                    <!-- ÜYE ÖZEL LİNKLERİ -->
                    @if (SignInManager.IsSignedIn(User))
                    {
                    <li class="nav-item">
                        <a class="nav-link px-3" asp-controller="Appointments" asp-action="Index">Randevular</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-3 text-primary" asp-controller="AI" asp-action="Index">
                            <i class="bi bi-stars"></i> AI Asistan
                        </a>
                    </li>
                    }

                    <!-- ADMIN ÖZEL LİNKLERİ -->
                    @if (SignInManager.IsSignedIn(User) && User.IsInRole("Admin"))
                    {
                    <li class="nav-item dropdown">
                        <a class="nav-link px-3 dropdown-toggle text-danger" href="#" data-bs-toggle="dropdown">Yönetim</a>
                        <ul class="dropdown-menu shadow border-0 animate__animated animate__fadeIn">
                            <li><h6 class="dropdown-header">Sistem</h6></li>
                            <li><a class="dropdown-item" asp-controller="GymBranches" asp-action="Index">Şubeler</a></li>
                            <li><a class="dropdown-item" asp-controller="Trainers" asp-action="Index">Eğitmenler</a></li>
                            <li><a class="dropdown-item" asp-controller="Services" asp-action="Index">Hizmetler</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">Operasyon</h6></li>
                            <li><a class="dropdown-item text-warning" asp-controller="Appointments" asp-action="Pending">Talepler</a></li>
                            <li><a class="dropdown-item text-info" asp-controller="Admin" asp-action="Reports">Raporlar</a></li>
                        </ul>
                    </li>
                    }
                </ul>

                <!-- SAĞ TARAFA YASLI PROFİL MENÜSÜ (SORUNU ÇÖZEN KISIM) -->
                <ul class="navbar-nav ms-auto align-items-center">
                    @if (SignInManager.IsSignedIn(User))
                    {
                    <!-- Profil Dropdown: Uzun isimleri gizler, tıkla aç mantığı -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle btn btn-light rounded-pill px-3 border" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle fs-5 align-middle me-1"></i>
                            <span class="align-middle">Hesabım</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow border-0 p-3 animate__animated animate__fadeIn" style="min-width: 250px;">
                            <!-- Kullanıcı Bilgisi Burada Yazar -->
                            <li class="text-center mb-2">
                                <div class="bg-light rounded-circle d-inline-flex p-3 mb-2">
                                    <i class="bi bi-person-fill fs-3 text-secondary"></i>
                                </div>
                                <div class="fw-bold text-truncate" title="@User.Identity?.Name" style="max-width: 220px; margin: 0 auto;">
                                    @User.Identity?.Name
                                </div>
                                <small class="text-muted">Üye</small>
                            </li>
                            <li><hr class="dropdown-divider"></li>

                            <li>
                                <a class="dropdown-item py-2 rounded" asp-controller="Profile" asp-action="Index">
                                    <i class="bi bi-gear me-2"></i> Profil Ayarları
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item py-2 rounded text-danger" asp-controller="Account" asp-action="Logout">
                                    <i class="bi bi-box-arrow-right me-2"></i> Çıkış Yap
                                </a>
                            </li>
                        </ul>
                    </li>
                    }
                    else
                    {
                    <li class="nav-item">
                        <a class="nav-link fw-bold" asp-controller="Account" asp-action="Login">Giriş</a>
                    </li>
                    <li class="nav-item ms-2">
                        <a class="btn btn-primary rounded-pill px-4 shadow-sm" asp-controller="Account" asp-action="Register">Kayıt Ol</a>
                    </li>
                    }
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="flex-grow-1" style="margin-top: 100px;">
    @RenderBody()
</div>

<!-- Footer -->
<footer class="footer-custom bg-dark text-light pt-5 pb-3 mt-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 mb-4">
                <h5 class="text-white mb-3 fw-bold"><i class="bi bi-activity"></i> Fitness Center</h5>
                <p class="text-muted small">Sağlıklı bir yaşam için profesyonel destek.</p>
            </div>
            <div class="col-lg-4 mb-4">
                <h6 class="text-white mb-3">Hızlı Linkler</h6>
                <ul class="list-unstyled small">
                    <li><a asp-controller="Public" asp-action="Gyms" class="text-decoration-none text-muted">Şubeler</a></li>
                    <li><a asp-controller="Public" asp-action="Trainers" class="text-decoration-none text-muted">Eğitmenler</a></li>
                </ul>
            </div>
            <div class="col-lg-4 mb-4 text-end">
                <small class="text-muted">&copy; 2025 Fitness Center</small>
            </div>
        </div>
    </div>
</footer>

<!-- Scripts -->
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="~/js/site.js" asp-append-version="true"></script>
<!-- Genel UI Efektleri ve SweetAlert Tetikleyici -->
<!-- Genel UI Efektleri ve SweetAlert Tetikleyici -->
<script>
        $(document).ready(function () {
            // Tablo satırlarına hover efekti
            $('table tbody tr').hover(
                function() { $(this).addClass('table-active'); },
                function() { $(this).removeClass('table-active'); }
            );

            // --- SWEETALERT ENTEGRASYONU (Final Düzeltme) ---
            
            var successMsg = '@Html.Raw(TempData["Success"] ?? "")';
            var errorMsg = '@Html.Raw(TempData["Error"] ?? "")';

            if (successMsg) {
                Swal.fire({
                    icon: 'success',
                    title: 'Başarılı!',
                    text: successMsg,
                    timer: 3000,
                    showConfirmButton: false,
                    toast: true,
                    position: 'top-end'
                });
            }

            if (errorMsg) {
                Swal.fire({
                    icon: 'error',
                    title: 'Hata!',
                    text: errorMsg
                });
            }
        });
    </script>

@await RenderSectionAsync("Scripts", required: false)
</body>
</html>